---
title: "Innovar Toolkit"
author: "Innovalab team"
date: "`r Sys.Date()`"
output: html_document
---

<script>
   $(document).ready(function() {
     $head = $('#header');
     $head.prepend('<img src=\"https://user-images.githubusercontent.com/23284899/157940984-80c8e9ff-cd5a-4207-b5fd-5be95b0f920f.png\" style=\"float: right;width: 150px;\"/>')
   });
</script>

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Package of functions of the Laboratory of Innovation in Health (InnovaLab) of the Institute of Tropical Medicine "Alexander von Humboldt", Universidad Peruana Cayetano Heredia.

### 1. Requeriments

```{r ,eval=TRUE, warning=FALSE,message=FALSE}
library(innovar)
library(sf)
library(rgee)
library(tidyverse)
library(viridis)
library(cowplot)
library(mapview)
ee_Initialize() # edit
```
### 2. Vector layer reading of Peru

```{r ,message=F,warning=F,eval = TRUE}
data("Peru")
peru.region <- Peru %>%
  dplyr::group_by(dep) %>%
  summarise()

glimpse(peru.region)
```

### 4. Exploration Peru map

```{r,out.width="100%"}
mapview(peru.region,legend = NULL)
```

### 3. Transformation of sf object to a feature collection

```{r ,message=F,warning=F,eval=TRUE}
peru.ee <- peru.region %>% 
  pol_as_ee(
    id = c("dep"),
    simplify = 100
    )
```

### 4. Processing data with innovar

```{r ,message=F,warning=F,eval=FALSE}
peru.ndvi <- peru.ee %>%
  get_vegetation(
    from = "2018-01-01",
    to = "2019-12-31",
    band = "NDVI",
    fun = "mean")

peru.def <- peru.ee %>%
  get_def(
    from = "2018-02-01",
    to = "2019-12-31"
    )

peru.pr <- peru.ee %>%
  get_climate(
    from = "2018-02-01",
    to = "2019-12-31",
    by = "month",
    band = "pr",
    fun = "mean"
    )
```

### 5. Processing data for mapping

```{r ,message=F,warning=F,eval=FALSE}
peru.ndvi.sf <- inner_join(peru.region,peru.ndvi,"dep")
peru.pr.sf <- inner_join(peru.region,peru.pr ,"dep")
peru.def.sf <- inner_join(peru.region,peru.def,"dep")
```


### 6. Exploration peru.ndvi.sf


### 7. Exploration peru.pr.sf


### 8. Exploration peru.def.sf


### 9. Mapping climate variables with the innovar theme

```{r,message=F,warning=F,fig.height=10,fig.width=15,eval=FALSE}
pr.plot<-   peru.pr.sf %>%
            ggplot() +
            geom_sf(aes(fill=`pr2019-01`)) +
            scale_fill_lis(discrete = FALSE,name="Precipitation") +
            theme_bw()
```

```{r,message=F,warning=F,fig.height=10,fig.width=15,eval=FALSE}
ndvi.plot<- peru.ndvi.sf %>%
            ggplot() +
            geom_sf(aes(fill=`NDVI2019-01`)) +
            scale_fill_lis(discrete = FALSE,name="NDVI") +
            theme_bw()
```


```{r,message=F,warning=F,fig.height=10,fig.width=15,eval=FALSE}
def.plot <-  peru.def.sf %>%
             ggplot() +
             geom_sf(aes(fill=Adef_2019)) +
             scale_fill_lis(discrete = FALSE,name="Deforestation") +
             theme_bw()
plot_grid(pr.plot,ndvi.plot,def.plot,nrow = 1)
````
