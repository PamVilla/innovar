---
title: "gen_admin.div"
subtitle: Create categories for adiministrative divisions (Perú) `r format(Sys.time(),"%Y/%m/%d")`
output:
  pdf_document:
    toc: yes
  html_document:
    df_print: paged
    number_sections: yes
---
```{r, echo=FALSE, results='hide',eval=TRUE,message = FALSE,warning = FALSE}
library(kableExtra)
library(tidyverse)
library(sf)
library(rmapshaper)
library(ggpubr)
```


## Description

Function 'gen_admin.div' returns the natural, geographical, or administrative division of Perú that includes the region, province or district provided to the function.

```{r, eval=F}
gen_admin.div <- function(x, method="Traditional")
```

## Arguments

- **x** is a list/vector with one of the 25 regions/departments names of Perú (first-level administrative subdivisions) 

- **method** defines the type of natural, geographical, or administrative division that should be returned
  + Traditional: Coastal, Andes Mountains, Amazon Jungle, or Lima & Callao
  + TC: [Administratives Macro Regions of the Constitutional Tribunal](https://andina.pe/agencia/noticia-tc-crea-cinco-macro-regiones-para-facilitar-acceso-a-justicia-constitucional-604658.aspx)
  + Cardinal: North, South, Amazon Jungle, or Lima & Callao
  + Traditional Cardinal:  Coastal and Andes Mountains are divided into North and South (e.g. South Andes Mountains)

```{r}
gen_admin.div <- function(x, 
                         method="Traditional") {
  reg.mountain.north <- c("CAJAMARCA","AMAZONAS","SAN MARTIN","HUANUCO","PASCO")
  reg.mountain.south <- c("JUNIN","CUSCO","PUNO","APURIMAC","AYACUCHO","HUANCAVELICA")
  reg.coastal.north <- c("TUMBES","PIURA","LAMBAYEQUE","LA LIBERTAD","ANCASH")
  reg.coastal.south <- c("ICA","AREQUIPA","TACNA","MOQUEGUA")
  
  reg.south <- c("JUNIN","HUANCAVELICA","ICA","AYACUCHO","APURIMAC",
                 "AREQUIPA","MOQUEGUA","TACNA","PUNO","CUSCO")
  reg.north <- c("TUMBES","PIURA","LAMBAYEQUE","LA LIBERTAD","ANCASH",
                 "CAJAMARCA","AMAZONAS","SAN MARTIN","HUANUCO","PASCO")
  reg.jungle <- c("LORETO","UCAYALI","MADRE DE DIOS")
  
  reg.tc.north <- c("ANCASH","CAJAMARCA","LA LIBERTAD",
                    "LAMBAYEQUE","PIURA","TUMBES")
  reg.tc.center <- c("APURIMAC","AYACUCHO","HUANCAVELICA",
                     "HUANUCO","JUNIN","PASCO","ICA")
  reg.tc.south <- c("AREQUIPA","CUSCO","MADRE DE DIOS",
                    "MOQUEGUA","PUNO","TACNA")
  reg.tc.east <- c("AMAZONAS","LORETO","SAN MARTIN","UCAYALI")
  
  if(method=="Traditional") {
    
    x = replace(x, x %in% reg.jungle,"AMAZON JUNGLE")
    x = replace(x, x %in% reg.mountain.north | x %in% reg.mountain.south,"ANDES MOUNTAINS")
    x = replace(x, x %in% reg.coastal.north | x %in% reg.coastal.south,"COASTAL")
    x = replace(x, x=="CALLAO" | x=="LIMA","LIMA & CALLAO")
    
  } else if(method=="TC") {
    
    x = replace(x, x %in% reg.tc.north,"NORTH")
    x = replace(x, x %in% reg.tc.south,"SOUTH")
    x = replace(x, x %in% reg.tc.center,"CENTER")
    x = replace(x, x %in% reg.tc.east,"EAST")
    x = replace(x, x=="CALLAO" | x=="LIMA","LIMA & CALLAO")
# Deberian ser solo los distritos de Lima, Callao, más Huarua/Cañete. Por ahora todo LIMA will do just fine
  } else if(method=="Cardinal") {
    
    x = replace(x, x %in% reg.north,"NORTH")
    x = replace(x, x %in% reg.south ,"SOUTH")
    x = replace(x, x %in% reg.jungle,"AMAZON JUNGLE")
    x = replace(x, x=="CALLAO" | x=="LIMA","LIMA & CALLAO")
    
  } else if(method=="Traditional Cardinal") {
    
    x = replace(x, x %in% reg.jungle,"AMAZON JUNGLE")
    x = replace(x, x %in% reg.mountain.south,"SOUTH ANDES MOUNTAINS")
    x = replace(x, x %in% reg.mountain.north,"NORTH ANDES MOUNTAINS")
    x = replace(x, x %in% reg.coastal.north,"NORTH COAST")
    x = replace(x, x %in% reg.coastal.south,"SOUTH COAST")
    x = replace(x, x=="CALLAO" | x=="LIMA","LIMA & CALLAO")
  }
  return(x)
}
```

## Examples

```{r}
df <- data.frame(reg=c("LIMA","CALLAO","CAJAMARCA","AMAZONAS","SAN MARTIN","HUANUCO",
                       "PASCO","JUNIN","CUSCO", "PUNO","APURIMAC","AYACUCHO",
                       "HUANCAVELICA","TUMBES","PIURA","LAMBAYEQUE","LA LIBERTAD",
                       "ANCASH","ICA","AREQUIPA","TACNA","MOQUEGUA","LORETO","UCAYALI",
                       "MADRE DE DIOS"),
                 stringsAsFactors=F)
```

```{r, eval=F}
df %>% 
  mutate(reg.Trad = gen_admin.div(reg),
         reg.TC = gen_admin.div(reg, method = "TC"),
         reg.Card = gen_admin.div(reg, method = "Cardinal"),
         reg.Trad_Card = gen_admin.div(reg, method = "Traditional Cardinal"))

```

```{r, echo=FALSE}
df %>% 
  mutate(reg.Trad = gen_admin.div(reg),
         reg.TC = gen_admin.div(reg, method = "TC"),
         reg.Card = gen_admin.div(reg, method = "Cardinal"),
         reg.Trad_Card = gen_admin.div(reg, method = "Traditional Cardinal")) %>%
  arrange(reg.Trad_Card) %>%
  kbl()%>%
  kable_styling(latex_options = "striped")

```

```{r, error=F, warning=F,message=F,results = F, echo =F}
shp.dep <- st_read("./Shapefile Regional", 
                   stringsAsFactors = F)%>% 
  st_transform(4326) %>% 
  dplyr::select(reg = NOMBDEP)%>%
  ms_simplify(keep=0.0075) %>% 
  inner_join(df %>% 
  mutate(reg.Trad = gen_admin.div(reg),
         reg.TC = gen_admin.div(reg, method = "TC"),
         reg.Card = gen_admin.div(reg, method = "Cardinal"),
         reg.Trad_Card = gen_admin.div(reg, method = "Traditional Cardinal")),
  )
```


```{r, error=F, warning=F,message=F,results = F, echo =F,fig.height=3}
ggarrange(shp.dep  %>%
            ggplot() +geom_sf(aes(fill = reg.Trad))+theme_bw()+ 
            theme(legend.position = "none")+ scale_color_brewer(palette = "Dark2"),
          shp.dep  %>%
            ggplot() +geom_sf(aes(fill = reg.TC))+theme_bw()+ 
            theme(legend.position = "none")+ scale_color_brewer(palette = "Dark2"),
          shp.dep  %>%
            ggplot() +geom_sf(aes(fill = reg.Card))+theme_bw()+ 
            theme(legend.position = "none")+ scale_color_brewer(palette = "Dark2"),
          shp.dep  %>%
            ggplot() +geom_sf(aes(fill = reg.Trad_Card))+theme_bw()+ 
            theme(legend.position = "none")+ scale_color_brewer(palette = "Dark2"),
          nrow = 2,ncol=2, 
          labels = c("A","B","C","D") )    

```
